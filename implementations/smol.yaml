---
smol_agent_protocol:
  title: "Code Minimalization as Constraint Optimization"
  version: 1.0.0
  
  optimization_problem:
    objective:
      function: "f(x) = size(code)"
      goal: minimize
      unit: bytes
    
    constraints:
      - type: hard_constraint
        function: "g(x) = functionality(original) - functionality(optimized)"
        requirement: "g(x) == 0"
        description: "Functionality must be preserved exactly"

  phases:
    phase_1_baseline:
      name: "Baseline Establishment"
      steps:
        measure_initial_state:
          - record_byte_count: "Get exact size in bytes"
          - document_functionality: "Record all behaviors to preserve"
          - run_tests: "Execute test suite for baseline"
          - create_verification_suite: "Build or identify tests"
        
        identify_optimization_surface:
          - scan_removable_elements: "Find comments, whitespace, verbose syntax"
          - map_transformation_opportunities: "Identify possible optimizations"
          - prioritize_by_byte_savings: "Order by expected impact"
    
    phase_2_optimization:
      name: "Iterative Optimization Loop"
      
      transformations:
        syntax_compaction:
          priority: 1
          techniques:
            - remove_unnecessary_whitespace
            - eliminate_optional_semicolons
            - use_shorthand_operators
            - shorten_variable_names
          
        statement_reduction:
          priority: 2
          techniques:
            - convert_to_arrow_functions: "function f(){} ‚Üí f=()=>{}"
            - use_comma_operator: "Combine statements"
            - merge_conditionals: "Simplify control flow"
            - eliminate_redundant_paths: "Remove dead code"
        
        structural_optimization:
          priority: 3
          techniques:
            - hoist_constants: "Reduce repetition"
            - extract_repeated_patterns: "DRY principle"
            - scientific_notation: "4000 ‚Üí 4e3"
            - inline_single_use_variables: "Remove intermediates"
        
        semantic_equivalence:
          priority: 4
          techniques:
            - shorter_string_equivalents: "Use shorter patterns"
            - shorter_property_access: "Optimize object access"
            - leverage_coercion_rules: "Use JS coercion"
            - implicit_undefined_returns: "Remove explicit undefined"
      
      verification_protocol:
        steps:
          - syntax_check: "node -c <file>"
          - measure_new_size: "wc -c <file>"
          - run_functionality_tests: "npm test"
          - document_change: "Record transformation and savings"
      
      decision_rules:
        accept:
          condition: "functionality_preserved AND size_reduced"
          action: continue_optimization
          
        neutral:
          condition: "functionality_preserved AND size_same"
          action: try_different_optimization
          
        reject_size:
          condition: "functionality_preserved AND size_increased"
          action: revert_changes
          
        reject_func:
          condition: "NOT functionality_preserved"
          action: revert_immediately
          priority: highest
      
      iteration_strategy:
        versioning: "create_numbered_versions"
        pattern: "file-v1.js, file-v2.js, ..."
        targeting: "one_transformation_category_per_iteration"
        termination: "no_further_size_reduction_possible"
        comparison: "compare_all_versions_for_optimal"
    
    phase_3_finalization:
      name: "Validation and Finalization"
      
      comprehensive_testing:
        - run_full_test_suite
        - verify_edge_cases
        - confirm_error_handling
        - validate_output_matches_original
      
      documentation:
        - record_final_byte_count
        - calculate_reduction_percentage
        - document_key_transformations
        - note_limitations_and_tradeoffs

  principles:
    - name: "Functionality is Sacred"
      description: "Never sacrifice working code for size"
      emoji: "‚ö†Ô∏è"
      
    - name: "Measure Everything"
      description: "Every change must be measured in bytes"
      emoji: "üìè"
      
    - name: "Verify Continuously"
      description: "Test after every transformation"
      emoji: "‚úì"
      
    - name: "Version Iteratively"
      description: "Keep track of each optimization attempt"
      emoji: "üîÑ"
      
    - name: "Embrace Reversibility"
      description: "Be ready to revert any change"
      emoji: "‚Ü©"
      
    - name: "Converge Systematically"
      description: "Stop when no more byte savings found"
      emoji: "‚ö°"

  metrics:
    primary:
      name: total_byte_reduction
      unit: bytes
      formula: "initial_size - final_size"
      
    secondary:
      name: optimization_iterations
      unit: count
      formula: "number_of_successful_passes"
      
    constraint:
      name: functionality_preservation
      unit: percentage
      requirement: 100
      formula: "test_pass_rate"
      
    efficiency:
      name: reduction_percentage
      unit: percentage
      formula: "100 * (initial_size - final_size) / initial_size"

  example_results:
    initial_size: 1047
    final_size: 803
    reduction:
      bytes: 244
      percentage: 23.3
    iterations: 10
    functionality_preserved: true
    test_pass_rate: 100

  implementations:
    languages:
      lisp_family:
        - guile_scheme
        - common_lisp
        - emacs_lisp
        - echo_lisp
        - racket
      
      logic:
        - prolog
      
      systems:
        - c
        - cpp
        - go
        - zig
        - limbo
      
      scripting:
        - perl
        - raku
        - python
        - ruby
        - julia
      
      functional:
        - haskell
        - ocaml
      
      esoteric:
        - forth
    
    total_count: 19
    
  metadata:
    author: "Smol Agent"
    repository: "e9-o9/smallest-agent"
    license: "Educational/Research"
    related_concepts:
      - code_golf
      - constraint_optimization
      - program_transformation
      - software_testing
